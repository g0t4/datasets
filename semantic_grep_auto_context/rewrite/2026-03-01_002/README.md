refactor a function to move the end of it outside to the caller => big win to let gptoss120b do it!

